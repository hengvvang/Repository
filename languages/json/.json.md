## JSON 语法全解

### 一、JSON 简介
JSON（JavaScript Object Notation）是一种轻量级、基于文本的数据交换格式，源自 ECMAScript 第3版（1999年）的对象字面量语法，标准化于 **ECMA-404**（2013年）和 **RFC 8259**（2017年）。它设计简单，易于人类阅读和机器解析，广泛用于数据存储、API 通信和跨语言数据交换。

---

### 二、JSON 的核心结构
JSON 文件由单个“值”（value）组成，值可以是以下两种结构之一：
1. **对象（Object）**：键值对的无序集合，用 `{}` 包裹。
2. **数组（Array）**：值的有序列表，用 `[]` 包裹。

这些结构支持嵌套，且值的类型严格限定为以下六种。

---

### 三、JSON 支持的数据类型
JSON 支持以下 6 种数据类型，每种类型有明确的语法规则：

#### 1. 字符串（String）
- **定义**：零个或多个 Unicode 字符的序列。
- **语法**：
  - 必须用双引号 `"`（U+0022）包裹，例如 `"hello"`。
  - 单引号 `'` 或无引号无效。
  - 空字符串为 `""`。
- **字符规则**：
  - 支持所有 Unicode 字符（包括中文、emoji 等）。
  - 控制字符（U+0000 到 U+001F）必须转义。
- **转义字符**（以 `\` 开头，U+005C）：
  - `\"`：双引号。
  - `\\`：反斜杠。
  - `\/`：正斜杠（可选，通常为 URL 兼容性）。
  - `\b`：退格符 (U+0008)。
  - `\f`：换页符 (U+000C)。
  - `\n`：换行符 (U+000A)。
  - `\r`：回车符 (U+000D)。
  - `\t`：制表符 (U+0009)。
  - `\uXXXX`：4 位十六进制 Unicode 码点（0000-FFFF），如 `\u4e2d` 表示“中”。
- **边缘细节**：
  - 支持代理对（surrogate pairs）表示超出 BMP（基本多文种平面）的字符，例如 emoji `\ud83d\ude00`（😀）。
  - 未定义的转义序列（如 `\z`）无效。
- **示例**：
  ```json
  "Hello \"World\"\n\t\\u4e2d"
  ```

#### 2. 数字（Number）
- **定义**：整数、浮点数或科学计数法表示的数值。
- **语法**：
  - 不使用引号。
  - 支持形式：
    - 整数：`123`、`-456`。
    - 小数：`0.5`、`-12.34`。
    - 科学计数法：`1.23e-4`、`2E10`。
  - 规则：
    - 正数可省略 `+`，负数需用 `-`。
    - 不能以 `0` 开头（除非是 `0` 或小数），如 `0123` 无效。
    - 小数点后必须有数字，`.5` 无效，需为 `0.5`。
    - 科学计数法中 `e` 或 `E` 后需接指数，指数可带 `+` 或 `-`。
- **限制**：
  - 不支持 `Infinity`、`-Infinity`、`NaN`。
  - 不支持八进制（如 `077`）或十六进制（如 `0xFF`）。
- **范围**：
  - 无明确范围限制，依赖解析器实现（JavaScript 中约为 ±2^53）。
- **示例**：
  ```json
  42, -10, 3.14159, 1.23e-4
  ```

#### 3. 布尔值（Boolean）
- **定义**：表示真或假。
- **语法**：
  - 仅为 `true` 或 `false`。
  - 必须小写，其他形式（如 `TRUE`、`True`）无效。
  - 不使用引号。
- **示例**：
  ```json
  true, false
  ```

#### 4. 空值（Null）
- **定义**：表示无值或空。
- **语法**：
  - 写作 `null`。
  - 必须小写，其他形式（如 `NULL`、`Null`）无效。
  - 不使用引号。
- **示例**：
  ```json
  null
  ```

#### 5. 对象（Object）
- **定义**：键值对的无序集合。
- **语法**：
  - 用 `{}` 包裹。
  - 包含零个或多个键值对。
  - **键**：
    - 必须是字符串（遵循字符串规则）。
    - 用双引号包裹。
    - 在同一对象中，键名应唯一（重复键行为未定义，依赖解析器）。
  - **值**：
    - 可以是任意 JSON 数据类型。
  - **分隔符**：
    - 键和值之间用 `:`（U+003A）。
    - 键值对之间用 `,`（U+002C）。
    - 最后一个键值对后无逗号。
  - **空对象**：`{}`。
- **示例**：
  ```json
  {"name": "Alice", "age": 25}
  ```

#### 6. 数组（Array）
- **定义**：值的有序列表。
- **语法**：
  - 用 `[]` 包裹。
  - 包含零个或多个值。
  - 值之间用 `,` 分隔，最后一个值后无逗号。
  - 值可以是任意 JSON 数据类型。
  - **空数组**：`[]`。
- **示例**：
  ```json
  [1, "two", true, {"key": "value"}]
  ```

---

### 四、JSON 语法规则的细节
#### 1. 分隔符
- **冒号 `:`**：用于键值对中，分隔键和值。
- **逗号 `,`**：用于分隔对象中的键值对或数组中的元素。
- **尾随逗号**：最后一个元素后不允许有逗号，例如 `{"a": 1,}` 或 `[1,]` 无效。

#### 2. 空白字符
- 支持以下空白字符（不影响数据含义，仅用于格式化）：
  - 空格 (U+0020)。
  - 水平制表符 (U+0009)。
  - 换行符 (U+000A)。
  - 回车符 (U+000D)。
- 其他 Unicode 空白字符（如 U+00A0）可能导致解析失败。

#### 3. 嵌套规则
- 对象和数组可无限嵌套。
- 示例：
  ```json
  {"a": [1, {"b": 2}]}
  ```

#### 4. 顶层值
- JSON 文件的顶层必须是一个值：
  - 通常是对象或数组（如 `{"key": "value"}`）。
  - 也可以是单一值（如 `"hello"`、`42`），但较少见。

---

### 五、JSON 的严格约束与未覆盖细节
以下是 JSON 语法中的严格要求和之前可能未强调的细节：
1. **引号限制**：
   - 键和字符串必须用双引号，单引号 (`'`)、反引号 (```) 或无引号无效。
2. **大小写敏感**：
   - `true`、`false`、`null` 必须小写。
3. **不支持注释**：
   - 不支持 `//`（行注释）或 `/* */`（块注释）。
   - 需在生成 JSON 的代码中处理注释。
4. **编码要求**：
   - 默认使用 UTF-8，无 BOM（字节顺序标记）。
   - 也支持 UTF-16（大端或小端）和 UTF-32（需带 BOM）。
   - 解析器需正确处理编码。
5. **键名唯一性**：
   - 标准未定义重复键的行为（可能取最后一个值或报错）。
   - 示例：
     ```json
     {"key": 1, "key": 2}  // 未定义行为
     ```
6. **不支持非标准类型**：
   - 不支持 JavaScript 特有类型，如：
     - `undefined`。
     - 函数（如 `"func": function() {}`）。
     - 日期对象（如 `new Date()`）。
     - 正则表达式（如 `/abc/`）。
7. **数字精度**：
   - 无明确精度限制，但实现可能受限（如 IEEE 754 双精度浮点数）。
8. **字符序列完整性**：
   - 不完整转义（如 `"abc\`）或未闭合引号（如 `"abc`）会导致解析失败。

---

### 六、JSON 的边缘情况
1. **最小合法 JSON**：
   - 空对象：`{}`
   - 空数组：`[]`
   - 单值：`"a"`、`1`、`true`、`null`
2. **复杂转义**：
   - `"\""`（仅含一个双引号）。
   - `"\ud83d\ude00"`（emoji 😀）。
3. **嵌套深度**：
   - 理论上无限，实际受解析器限制。

---

### 七、JSON 的完整示例
综合所有规则：
```json
{
  "id": 123,
  "name": "张三\n\"Li\"",
  "scores": [90, -12.34, 1.23e2, 0],
  "active": true,
  "data": null,
  "details": {
    "phone": "",
    "tags": ["a", "b"],
    "meta": {}
  },
  "emoji": "\ud83d\ude00",
  "unicode": "\u4e2d\u6587"
}
```

---

### 八、JSON 的文件与应用
- **文件格式**：
  - 扩展名为 `.json`（非强制）。
  - 可以是单行或多行。
- **用途**：
  - 配置文件（如 `package.json`）。
  - API 数据（如 `{"status": "success"}`）。
- **解析与生成**：
  - 解析：`JSON.parse()`（字符串 → 对象）。
  - 生成：`JSON.stringify()`（对象 → 字符串）。

---

### 九、JSON 的局限性与补充细节
1. **无序性**：
   - 对象中的键值对顺序不保证。
2. **无版本控制**：
   - JSON 本身无元数据标识版本。
3. **安全性**：
   - 不直接执行代码，但需防范 JSON 注入（如恶意键名）。
4. **扩展性**：
   - 不支持自定义类型，需转换为基本类型。

---

### 十、总结
JSON 语法的所有细节包括：
- **数据类型**：字符串、数字、布尔值、空值、对象、数组。
- **语法规则**：双引号、分隔符、无尾随逗号、无注释。
- **字符与编码**：Unicode 支持、UTF-8 默认。
- **限制**：无复杂类型、无精度定义。
- **边缘细节**：空结构、代理对、顶层值。

这已涵盖 JSON 语法的每一个方面，包括标准中未明确但实际相关的细节。如果需要更深入的某个部分，请告诉我！
